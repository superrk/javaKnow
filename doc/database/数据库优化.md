数据库优化的几个方面：语句以及有效索引、数据结构、系统配置、硬件 

![img](https://pic2.zhimg.com/50/v2-175a3346c893bca13849da4d91e7dfbd_hd.jpg)



1. SQL以及索引的优化是最重要的。首先要根据需求写出**结构良好**的SQL，然后根据SQL在表中建立**有效的**索引。但是如果索引太多，不但会影响写入的效率，对查询也有一定的影响。

2. 要根据一些范式来进行表结构的设计。设计表结构时，就需要考虑如何设计才能够更有效的查询。

3. 系统配置的优化。MySQL数据库是基于文件的，如果打开的文件数达到一定的数量，无法打开之后就会进行频繁的IO操作。

4. 硬件优化。更快的IO、更多的内存。一般来说内存越大，对于数据库的操作越好。但是**CPU多就不一定了，因为他并不会用到太多的CPU数量，有很多的查询都是单CPU**。另外使用高的IO（SSD、RAID），但是IO并不能减少数据库锁的机制。所以说如果查询缓慢是因为数据库内部的一些锁引起的，那么硬件优化就没有什么意义。

   
   
## 一、SQL语句优化
   
1、通过慢查询日志发现有效率问题的SQL
   
可以通过开启慢查询日志的方式进行定位有问题的SQL 
   

（1）查看MySQL是否开启慢查询日志
    show variables like 'slow_query_log';

   ![img](https://pic3.zhimg.com/50/v2-d91532c3b43ebefe26f972c03058a25b_hd.jpg)
（2）设置没有索引的记录到慢查询日志
    set global log_queries_not_using_indexes=on;

（3）查看超过多长时间的sql进行记录到慢查询日志
    show variables like 'long_query_time'

（4）开启慢查询日志
    set global slow_query_log=on

（5）设置超时时间
   Set global long_query_time=5;--超过5s的语句才记录日志 

   （6）查看慢查询日志的位置 show variables like 'slow%'

##    二、查询性能优化

   使用 Explain 进行分析
   Explain 用来分析 SELECT 查询语句，开发人员可以通过分析 Explain 结果来优化查询语句。

   比较重要的字段有：

   select_type : 查询类型，有简单查询、联合查询、子查询等
   key : 使用的索引
   rows : 扫描的行数

### 优化数据访问

1. 减少请求的数据量
只返回必要的列：最好不要使用 SELECT * 语句。
只返回必要的行：使用 LIMIT 语句来限制返回的数据。
缓存重复查询的数据：使用缓存可以避免在数据库中进行查询，特别在要查询的数据经常被重复查询时，缓存带来的查询性能提升将会是非常明显的。

### 索引优化

- 在进行查询时，索引列不能是表达式的一部分，也不能是函数的参数，否则无法使用索引。

- 在需要使用多个列作为条件进行查询时，使用多列索引比使用多个单列索引性能更好。例如下面的语句中，最好把 actor_id 和 film_id 设置为多列索引。

- 让选择性最强的索引列放在前面。

## 三、数据表结构优化

  1、选择合适的数据类型
  （1）使用可存下数据的最小的数据类型。

  （2）使用简单地数据类型，int要比varchar类型在mysql处理上更简单。

  （3）尽可能使用not null定义字段，这是由innodb的特性决定的，因为非not null的数据可能需要一些额外的字段进行存储，这样就会增加一些IO。可以对非null的字段设置一个默认值。

  （4）尽量少用text，非用不可最好分表，将text字段存放到另一张表中，在需要的时候再使用联合查询，这样可提高查询主表的效率。